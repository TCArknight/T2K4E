<?xml version="1.0" encoding="UTF-8"?>

<!-- This file contains the definition of the "Basics" tab panel. This tab is where
      the user configures that attributes and skills of the character.

      All public visual elements used with this tab panel start with the prefix "ba"
      to associate them with the tab.
-->

<document signature="Hero Lab Data">

  <portal
    id="vbaAttribVeh"
    style="tblInvis">
    <table_fixed
      component="Attribute"
      showtemplate="vbaAttrPick"
      showsortset="explicit"
      scrollable="no"
	  alwaysupdate="yes"
	  columns="2">
      <list>!(Hide.Attribute|AttrCat.Hero)</list>
      <headertitle><![CDATA[
        @text = "Vehicle  Attributes"
        @text &= hero.child[resAttrib].field[resShortAlt].text
        ]]></headertitle>
      </table_fixed>
    </portal>
	
  <template
    id="vbaAttrPick"
    name="Vehicle Attribute Pick"
    compset="Attribute"
    marginhorz="13"
    marginvert="9">

    <portal
      id="name"
      style="lblSmlLeft"
      showinvalid="yes">
      <label>
	    <labeltext><![CDATA[
		  if (field[atIsKey].value <> 0) then
            @text = "{text 008000}" & field[name].text & "{text 010101}"
		  else
		    @text = field[name].text
			endif
		  
		  ]]></labeltext>
        </label>
      </portal>
	  
    <portal
      id="value"
      style="lblSmlLeft">
      <label
          field="trtFinal">
        </label>
      </portal>

    <portal
      id="info"
      style="actInfo">
      <action
        action="info">
        </action>
      </portal>

    <position><![CDATA[
      ~set up our height based on our tallest portal
      height = portal[info].height

      ~if this is a "sizing" calculation, we're done
      doneif (issizing <> 0)

      ~freeze our value in advancement mode or if an advancement has modified us
      ~Note: All freezing must be done *before* any positioning is performed.
      if (state.iscreate = 0) then
        portal[value].freeze = 1
      elseif (autonomous = 0) then
        portal[value].freeze = 1
        endif

      ~position our tallest portal at the top
      portal[info].top = 0

      ~center the other portals vertically
      perform portal[name].centervert
      perform portal[value].centervert

      ~position the info portal on the far right
      perform portal[info].alignedge[right,0]

      ~position the incrementer to the left of the info portal (plus a gap)
      perform portal[value].alignrel[rtol,info,-5]
	  
      ~position the name on the left and make sure its width does not exceed the available space
      portal[name].left = 0
      portal[name].width = minimum(portal[name].width,portal[value].left - portal[name].left - 10)
      ]]></position>

    </template>
	
  <template
    id="vbaDetails"
    name="Details"
    compset="VehicleDetails">

    <portal
      id="title"
      style="lblTitle">
      <label
        istitle="yes"
        text="Details">
        </label>
      </portal>

    <portal
      id="lblVehCat"
      style="lblLeft">
      <label>
        <labeltext><![CDATA[
			@text = "Category: " & field[vdeCategory].text
            ]]></labeltext>
        </label>
      </portal>

    <portal
      id="lblVehType"
      style="lblLeft">
      <label>
        <labeltext><![CDATA[
			@text = "Vehicle Type: " & field[vdeType].text
            ]]></labeltext>
        </label>
      </portal>
	  
    <portal
      id="lblVehRel"
      style="lblLeft">
      <label>
        <labeltext><![CDATA[
			@text = "Reliability: " & field[vdeReliability].text
            ]]></labeltext>
        </label>
      </portal>

    <portal
      id="lblVehCbtSpeed"
      style="lblLeft">
      <label>
		<labeltext><![CDATA[
			@text = "Combat Speed: " & field[vdeCombatSpeedOn].text & " / " & field[vdeCombatSpeedOff].text
			]]></labeltext>
		</label>
      </portal>

    <portal
      id="lblVehTravSpeed"
      style="lblLeft">
      <label>
		<labeltext><![CDATA[
		  var speed as string
		   
		  speed = "Travel Speed: " & field[vdeTravelSpeedOn].text 
		  if (empty(field[vdeTravelSpeedOff].text) = 0) then
			speed &= " / " & field[vdeTravelSpeedOff].text 
			endif
		  
		  @text = speed
		  
		  perform hero.findchild[VehicleBase].setfocus
          doneif (state.isfocus = 0)
          
		  doneif (focus.tagis[VehicleMove.?] = 0)
		  
		  @text &= " " & focus.tagabbrevs[VehicleMove.?,","]
			
	      ]]></labeltext>
		</label>
      </portal>
	  
    <position><![CDATA[
	  var myWidth as number
	  var myLeft as number
	  myLeft = 2
	  myWidth = width/2 - 4

      ~position our tallest portal at the top
      portal[title].top = 0
	  portal[title].width = myWidth

      ~center the other portals vertically
      portal[lblVehCat].left = myLeft
	  portal[lblVehCat].width = myWidth
      portal[lblVehCat].top = portal[title].bottom + 5
	  
	  portal[lblVehType].top = portal[lblVehCat].bottom + 5
	  portal[lblVehType].left = myLeft
	  portal[lblVehType].width = myWidth

	  portal[lblVehRel].top = portal[lblVehType].bottom + 5
	  portal[lblVehRel].left = myLeft
	  portal[lblVehRel].width = myWidth
	  
	  portal[lblVehCbtSpeed].top = portal[lblVehRel].bottom + 5
	  portal[lblVehCbtSpeed].left = myLeft
	  portal[lblVehCbtSpeed].width = myWidth
	  
	  portal[lblVehTravSpeed].top = portal[lblVehCbtSpeed].bottom + 5
	  portal[lblVehTravSpeed].left = myLeft
	  portal[lblVehTravSpeed].width = myWidth
	  
      height = portal[lblVehTravSpeed].bottom + 5
	  
      ]]></position>

    </template>	  

  <!-- basics layout
        This layout orchestrates the display of all various visual elements that
        comprise the Basics tab. We have titles above the attributes and skills,
        the attributes and skills tables themselves, a horizontal separator, and
        the table of derived traits.

        Each of these portals and templates is identified as a "reference" by the
        layout. Using references allows distinct instances of portals and templates
        to be re-used within multiple layouts. You can even use the same template
        multiple times within a single layout.

        The visual elements used in the layout are all sized and positioned via
        the "position" script. This script is invoked to setup the dimensions of
        visual elements and trigger the positioning of the contents of those
        elements via the "render" invocation.

        The tab order between items is controlled via the optional "taborder" XML
        attribute on the various portal and template references. Conhin a template,
        the tab order is dictated by the order the portals are listed within the
        XML. Conhin a table, the tab order is dictated by the item sequence. The
        "taborder" attribute coordinates the relative sequence of portals and
        templates within the layout. In this layout, the tab order will move down
        the left column and then shift over to the right column.
  -->
  <layout
    id="vehbasics">
    <!-- <portalref portal="vbaAttribVeh" taborder="10"/> -->
    <templateref template="vbaDetails" thing="mscVehDetails" />

    <!-- This script sizes and positions the layout and its child visual elements. -->
    <position><![CDATA[
	  ~ perform portal[vbaAttribVeh].autoplace
	  perform template[vbaDetails].autoplace
	  
      ~figure out the total height we need for the tab
	  height = template[vbaDetails].bottom
	  
      ]]></position>

    </layout>


  <!-- basics panel
        This is the "Basics" panel shown within Hero Lab.

        The "order" attribute dictates the sequence in which the various tabs will
        be displayed. To keep everything well organized, We break the tabs up into
        four logical groupings: (1) traits and creation details, (2) equipment,
        (3) details, and (4) in-play support. Each of these groupings will have a
        three-digit value that starts with the grouping number. Since the Basics
        panel should appear first within the traits group, it has an order of "110".

        As we assign order values, We'll leave gaps in the sequence (e.g. 110, 120,
        etc.). This will allow us to easily change our minds and slip a new panel
        inbetween two existing ones as the data files evolve, without having to go
        through and re-number everything.

        We setup a suitable margin around the edges of the panel. This ensures that
        there is a little bit of spacing from the edges and eliminates the need for
        our positioning scripts to make the appropriate adjustments.

        Like with layouts, panels have a "position" script to setup the dimensions
        of child elements and orchestrate the rendering of their contents. In many
        cases, as with this panel, the default handling of panels will ensure that
        the layouts are properly rendered.

        The panel is assigned a "live" tagexpr so that its visibility can be
        controlled for different types of characters. While not really useful in the
        sample data files, this approach can be quite useful when the data files
        expand to govern creation of widely varying characters, such as vampires vs.
        ghosts vs. mortals in the World of Darkness game system.
  -->
  <panel
    id="vehbasics"
    name="Vehicle Basics"
    marginhorz="5"
    marginvert="5"
    order="110">
    <live>CharType.Vehicle</live>
    <layoutref layout="vehbasics"/>
    <position><![CDATA[
      ~get the height used by the layout and use it, as that means we scroll
      ~if necessary
      perform layout[vehbasics].render
      height = layout[vehbasics].height
      ]]></position>
    </panel>


  </document>
